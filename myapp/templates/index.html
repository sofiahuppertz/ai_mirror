<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, width=device-width">
    <link rel="icon" type="image/png" href="../static/makro-logo.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <title>AI MIRROR</title>
</head>

<body>
    <div id="header">
        <h1>AI MIRROR by Sebastian Errazuriz</h1>
    </div>
    <div id="container">
        <div id="book">
            <form action="/" method="POST">
                <div>
                    <div id="question">
                        <h1>{{ question }}</h1>
                   </div>
                   <div id="answer">
                       <p>{{ answer }}</p>
                   </div>
                </div>
                <div class="page-buttons">
                    <button type="submit" class="btn btn-outline-dark" name="action" value="previous">Previous Page</button>
                    <button type="submit" class="btn btn-outline-dark" name="action" value="next">Next Page</button>
                </div>
            </form>
        </div>
        <div id="chatbot">
            <div id="chatbot-title">
                <h3>A.I query bot</h3>
            </div>
            <div id="chat-history">
                <!-- Chat history will be displayed here -->
                <form action="/chatbot" method="POST" class="conversation-starters">
                    <button type="submit" class="btn btn-outline-dark" name="action" value="client_answer">Differing from the answer?</button>
                    <button type="submit" class="btn btn-outline-dark" name="action" value="client_question">Have another question?</button>
                </form>
            </div>
            <div class="input-container">
                <form action="/chatbot" method="POST" id="user-input">
                    <textarea rows="2" id="userInput" name="userInput"></textarea>
                    <button type="submit" class="btn" name="action" value="client_input">
                        <img src="../static/send-icon-2048x1863-u8j8xnb6.png" width="28px" alt="Send">
                    </button>
                </form>
            </div>
        </div>
    </div>
    <style>
        #container{
            margin : 50px;
        }

        #answer {
            padding-top: 10px;
            font-size: 20px;
        }

        .btn {
            border-radius: 30px;
        }

        .page-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        #chatbot
        {
            padding-top: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;            
        }

        #chat-history { 
            width: 500px; /* Adjust as needed */
            height: 400px; /* Adjust as needed */
            overflow-y: auto;
            border: 1px solid transparent; /* Invisible border */
            border-radius: 30px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
        }

        .conversation-starters {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .input-container {
            padding-top: 20px;
            width: 600px;

        }

        #user-input {
            display: flex;
            align-items: center;
        }

        #userInput {
            width: 550px;
            border-radius: 10px;
            background-color:rgb(236, 233, 233);
            border: 1px solid grey;
        }
    </style>
    <script>
        /* JavaScript to display conversation starters */
        document.addEventListener('DOMContentLoaded', (event) => {
            const conversationStarters = document.querySelector('.conversation-starters');
            const chatbotButtons = document.querySelectorAll('#chatbot button');
            let client_request = "";

            chatbotButtons.forEach(button => {
                button.addEventListener('click', (event) => {
                    event.preventDefault();
                    let userInput = document.querySelector('#userInput').value;

                    if (button.value != "client_input" || userInput) {
                        conversationStarters.style.display = 'none';
                        document.getElementById('chat-history').style.display = "block";
                    }
                    
                    if (button.value === 'client_input' && userInput) {
                        
                        let userMessageDiv = document.createElement('div');
                        userMessageDiv.textContent = userInput;

                        userMessageDiv.style.float = 'right';
                        userMessageDiv.style.clear = 'both';
                        userMessageDiv.style.border = '1px solid black';
                        userMessageDiv.style.borderRadius = '20px';
                        userMessageDiv.style.margin = '10px';
                        userMessageDiv.style.padding = '10px';
                        
                        document.querySelector('#chat-history').appendChild(userMessageDiv);
                        client_request = userInput;
                        document.querySelector('#userInput').value = '';
                    }
                    else if (button.value === 'client_answer')
                    {
                        client_request = "Differing from the answer"
                    }
                    else if (button.value === 'client_question')
                    {
                        client_request = "Have another question"
                    }

                    fetch('/chatbot', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            client_request: client_request
                        })
                    })

                });
            });
        });
    </script>
</body>
</html>

